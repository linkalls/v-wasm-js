# ベンチマーク

Vitrioは、SolidスタイルのDOM更新と細粒度のリアクティビティを通じて、最高レベルのパフォーマンスを目指しています。

## ベンチマークの実行

```bash
# Node.js 18+ と Playwright のインストールが必要です
node benchmarks/run-node.mjs
```

> ⚠️ 注意: 現在のベンチマークハーネスは、ハイドレーションを待たずに `DOMContentLoaded` からの Vitrio ロード時間を測定しています。詳細は `benchmarks/run-node.mjs` を参照してください。

## ベンチマーク結果 (2026-01-18)

| 指標 | Vitrio | SolidJS | React |
|--------|--------|---------|-------|
| バンドルサイズ | **11.6KB** | 13.0KB | 144.1KB |
| 平均ロード時間 | **14.34ms** | 36.22ms | 40.52ms |
| 100クリック | **2.18ms** | 10.17ms | 11.26ms |
| リスト更新 | **2.95ms** | 11.31ms | 8.75ms |

## パフォーマンス分析

### リスト更新
- VitrioはSolidより **284% 高速** (2.95ms vs 11.31ms)
- VitrioはReactより **197% 高速** (2.95ms vs 8.75ms)
- キー付き差分、高速な追加/削除パス、削除されたノードの自動クリーンアップを備えた最適化された `<For>` コンポーネントを使用しています。

### カウンター (100クリック)
- VitrioはSolidより **367% 高速** (2.18ms vs 10.17ms)
- VitrioはReactより **416% 高速** (2.18ms vs 11.26ms)

### バンドルサイズ
- **VitrioはSolidより 15% 小さい** (11.0KB vs 13.0KB)
- **VitrioはReactより 92% 小さい** (11.0KB vs 144.1KB)

### ロード時間
- Vitrioは今回の実行でも最速を維持しています (`DOMContentLoaded` で測定)

## "Win Everywhere" に対するステータス
今回の実行では、Vitrioは **バンドルサイズ**、**インタラクション時間**、**リスト更新**、**ロード時間** (ハイドレーションのタイミングに関する上記の注記を参照) でリードしています。

## 最適化履歴

### v0.1.3 (2026-01-15)
- `<For>` コンポーネントがJSXの子要素配列を正しく処理するように修正
- `<Show>` コンポーネントでも同様の問題を修正
- VNode互換性のためにJSX型定義を更新
- **リスト更新**: 12.7ms → 5.9ms (**53% 改善**)
- **バンドルサイズ**: 12.4KB → 10.3KB (**17% 削減**)

### v0.1.2 → v0.1.3 WASM最適化
- **WASMサイズ**: 3.9KB → 1.5KB (**61% 削減**)
- **JSバンドル**: 7.8KB → 4.5KB (**43% 削減**)
- `-d no_bounds_checking` ビルドフラグを追加

## なぜVitrioは速いのか

1. **SolidスタイルDOM**: DOMを一度作成し、バインディングのみを更新
2. **VDOM差分なし**: 直接的なDOM操作
3. **細粒度のサブスクリプション**: 影響を受けるノードのみが再レンダリング
4. **マーカーベースのフロー制御**: `Show`/`For` はコメントマーカーを使用
5. **キー付き差分**: `For` は既存のDOMノードを再利用
6. **バッチ更新**: 複数の状態変更はバッチ処理される
7. **WASM駆動グラフ**: 最適化されたWASM内での依存関係伝播

## ベンチマークアプリ

すべてのベンチマークアプリは同一の機能を持っています：
- 派生値 (×2) を持つカウンター
- 追加/削除機能付きTodoリスト
- トグルセクション

場所:
- `benchmarks/vitrio-app/` - Vitrio実装
- `benchmarks/solid-app/` - SolidJS実装
- `benchmarks/react-app/` - React実装
